<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>é ˆè³€åˆ©ãƒãƒƒãƒ—</title>
  <meta name="apple-mobile-web-app-title" content="é ˆè³€åˆ©ãƒãƒƒãƒ—">
  <meta name="application-name" content="é ˆè³€åˆ©ãƒãƒƒãƒ—">
  <!-- PWAè¨­å®š ã“ã“ã‹ã‚‰ -->
  <link rel="manifest" href="./manifest.webmanifest">
  <meta name="theme-color" content="#000000">

  <!-- Android / iOS ä¸¡å¯¾å¿œç”¨ï¼ˆã™ã§ã«ä¸€éƒ¨å…¥ã£ã¦ã„ã‚‹ã®ã§è£œå®Œï¼‰ -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <!-- PWAè¨­å®š ã“ã“ã¾ã§ -->
  
  <style>
    html, body { margin:0; height:100%; background:#000; overflow:hidden; }
.screen {
  position: fixed;
  inset: 0;
  opacity: 0;
  pointer-events: none;
  transition: opacity 300ms ease;
}
.screen.active {
  opacity: 1;
  pointer-events: auto;
}

    /* å¾…æ©Ÿï¼šMP4å‹•ç”» */
    #idleVideoWrap { width:100%; height:100%; }
    #idleVideo { width:100%; height:100%; object-fit:contain; background:#000; }

    /* Googleã‚¹ãƒ©ã‚¤ãƒ‰ */
    iframe { width:100%; height:100%; border:0; background:#000; }

    .hint {
      position:fixed; left:0; right:0; bottom:24px;
      text-align:center; color:rgba(255,255,255,.85);
      font: 20px/1.3 system-ui, -apple-system, "Segoe UI", sans-serif;
      pointer-events:none;
      text-shadow:0 2px 8px rgba(0,0,0,.6);
      z-index: 10;
    }

    /* â˜…è¿½åŠ ï¼šç¸¦å‘ããƒ–ãƒ­ãƒƒã‚¯ï¼ˆã“ã‚ŒãŒâ€œæ¨ªã«ã—ãªã„ã¨è¦‹ã‚Œãªã„â€ã‚’å®Ÿç¾ï¼‰ */
    #rotateBlock {
      position: fixed;
      inset: 0;
      background: #000;
      color: #fff;
      display: none;          /* JSã§ç¸¦ã®æ™‚ã ã‘flexã«ã™ã‚‹ */
      align-items: center;
      justify-content: center;
      text-align: center;
      z-index: 9999;
      padding: 24px;
      font: 20px/1.4 system-ui, -apple-system, "Segoe UI", sans-serif;
    }
    #rotateBlock .sub {
      opacity: .75;
      font-size: 14px;
      margin-top: 10px;
    }
  </style>
</head>
<body>

  <!-- â˜…è¿½åŠ ï¼šç¸¦å‘ãã®æ™‚ã«è¢«ã›ã‚‹ç”»é¢ -->
  <div id="rotateBlock">
    <div>
      <div style="font-size:42px; margin-bottom:14px;">ğŸ“±â†”ï¸</div>
      <div>æ¨ªå‘ãã«ã—ã¦ã”è¦§ãã ã•ã„</div>
      <div class="sub">ï¼ˆç¸¦å‘ãã§ã¯å†ç”Ÿãƒ»æ“ä½œã§ãã¾ã›ã‚“ï¼‰</div>
    </div>
  </div>

  <!-- å¾…æ©Ÿï¼šMP4å‹•ç”»ãƒ«ãƒ¼ãƒ—ï¼ˆæœ€åˆã¯ç„¡éŸ³ï¼‰ -->
  <div id="idle" class="screen active">
    <div id="idleVideoWrap">
      <video
        id="idleVideo"
        src="./main.mp4"
        autoplay
        muted
        loop
        playsinline
        webkit-playsinline
        preload="auto"
      ></video>
    </div>
    <div class="hint">â‘ ã‚¿ãƒƒãƒ—ã§éŸ³ONã€€â‘¡ã‚‚ã†ä¸€åº¦ã‚¿ãƒƒãƒ—ã§é–‹å§‹</div>
  </div>

  <!-- æ¢ç´¢ï¼šGoogleã‚¹ãƒ©ã‚¤ãƒ‰ï¼ˆã‚¹ãƒ©ã‚¤ãƒ‰1ã‹ã‚‰ï¼‰ -->
  <div id="explore" class="screen">
    <iframe id="slides" allowfullscreen></iframe>
  </div>

  <script>
    const SLIDE_ID = "1XTp8s8WNJa6qFl9K2akNzSv43JRHN-pQ";
    const IDLE_TIMEOUT_MS = 60000;

    const idleScreen = document.getElementById("idle");
    const exploreScreen = document.getElementById("explore");
    const slidesFrame = document.getElementById("slides");
    const idleVideo = document.getElementById("idleVideo");

    // åŠ¹æœéŸ³ï¼ˆç”»é¢é·ç§»ç”¨ï¼‰
const sfx = new Audio("./tap.mp3");
sfx.preload = "auto";
let audioUnlocked = false;

function unlockAudioOnce() {
  if (audioUnlocked) return;
  audioUnlocked = true;

  // iPhoneå¯¾ç­–ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œä¸­ã«ä¸€åº¦ã ã‘å†ç”Ÿâ†’å³åœæ­¢ã§â€œè§£æ”¾â€
  sfx.muted = true;
  sfx.play().then(() => {
    sfx.pause();
    sfx.currentTime = 0;
    sfx.muted = false;
  }).catch(() => {
    sfx.muted = false;
  });
}

function playSfx() {
  if (!audioUnlocked) return;
  sfx.currentTime = 0;
  sfx.play().catch(() => {});
}
    
    
    const rotateBlock = document.getElementById("rotateBlock");

    let timer = null;
    let tapStage = 0; // 0:ç„¡éŸ³ 1:éŸ³ã‚ã‚Š 2:æ¢ç´¢

    function slideEmbedUrl() {
      return `https://docs.google.com/presentation/d/${SLIDE_ID}/embed?rm=minimal&start=false`;
    }

    function showIdle() {
        playSfx(); // â˜…è¿½åŠ 
      exploreScreen.classList.remove("active");
      idleScreen.classList.add("active");
      slidesFrame.src = "about:blank";

      idleVideo.currentTime = 0;
      idleVideo.play().catch(() => {});
      clearTimeout(timer);
      timer = null;
    }

    function showExplore() {
        playSfx(); // â˜…è¿½åŠ 
      idleScreen.classList.remove("active");
      exploreScreen.classList.add("active");
      idleVideo.pause();
      slidesFrame.src = slideEmbedUrl();
      resetIdleTimer();
    }

    function resetIdleTimer() {
      clearTimeout(timer);
      timer = setTimeout(() => {
        tapStage = 0;
        idleVideo.muted = true;
        showIdle();
      }, IDLE_TIMEOUT_MS);
    }

    // â˜…è¿½åŠ ï¼šç¸¦å‘ãåˆ¤å®šï¼ˆç¸¦ãªã‚‰å®Œå…¨ãƒ–ãƒ­ãƒƒã‚¯ï¼‹å‹•ç”»åœæ­¢ï¼‰
    function applyOrientationGuard() {
      const isPortrait = window.matchMedia("(orientation: portrait)").matches
        || window.innerHeight > window.innerWidth;

      rotateBlock.style.display = isPortrait ? "flex" : "none";

      if (isPortrait) {
        // ç¸¦ã®ã¨ãã¯â€œå†ç”Ÿãƒ»æ“ä½œã•ã›ãªã„â€
        idleVideo.pause();
      } else {
        // æ¨ªã«æˆ»ã£ãŸã‚‰å¾…æ©Ÿç”»é¢ã‚’å†é–‹ï¼ˆç„¡éŸ³ã‹ã‚‰ï¼‰
        if (idleScreen.classList.contains("active")) {
          idleVideo.play().catch(() => {});
        }
      }
    }

    window.addEventListener("resize", applyOrientationGuard);
    window.addEventListener("orientationchange", applyOrientationGuard);

    // ã‚¿ãƒƒãƒ—æŒ™å‹•
document.addEventListener("pointerdown", () => {
  unlockAudioOnce(); // â˜…æœ€åˆã®ã‚¿ãƒƒãƒ—ã§å¿…ãšå®Ÿè¡Œ

  // ç¸¦å‘ããƒ–ãƒ­ãƒƒã‚¯ä¸­ã¯ä½•ã‚‚ã—ãªã„
  if (rotateBlock.style.display === "flex") return;

  if (idleScreen.classList.contains("active")) {

    // â‘  ç„¡éŸ³ â†’ éŸ³ON
    if (tapStage === 0) {
      tapStage = 1;
      idleVideo.muted = false;
      idleVideo.play().catch(() => {});
      return;
    }

    // â‘¡ éŸ³ON â†’ ã‚¹ãƒ©ã‚¤ãƒ‰ã¸
    if (tapStage === 1) {
      tapStage = 2;
      playSfx();        // â˜…â† ã“ã“ã§å¿…ãšé³´ã‚‰ã™ï¼ï¼
      showExplore();
      return;
    }

  } else {
    // ã‚¹ãƒ©ã‚¤ãƒ‰æ“ä½œä¸­
    resetIdleTimer();
  }
});


    ["pointermove","keydown","wheel","touchstart","mousemove"].forEach(ev => {
      document.addEventListener(ev, () => {
        if (rotateBlock.style.display === "flex") return;
        if (exploreScreen.classList.contains("active")) resetIdleTimer();
      }, { passive:true });
    });

    // èµ·å‹•
    showIdle();
    applyOrientationGuard();
  </script>

  <script>
  // Service Worker ç™»éŒ²ï¼ˆPWAã®å¿…é ˆï¼‰
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker.register("/sugari-map/sw.js").catch(console.error);
    });
  }
</script>

</body>
</html>








